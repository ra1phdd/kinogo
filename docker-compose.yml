version: '3.8'

services:
  kinogo:
    container_name: kinogo
    build:
      context: .
      target: dev
      network: host
    volumes:
      - ./:/app
      - ./media:/app/media
    extra_hosts:
      - "postgres:192.168.1.1"
    ports:
      - "4000:4000"
  redis:
    image: redis/redis-stack:latest
    container_name: redis-stack
    restart: unless-stopped
    volumes:
        - ./internal/config/redis/:/usr/local/etc/redis
    ports:
      - "6379:6379"
      - "8001:8001"
    command: [ "redis-server", "/usr/local/etc/redis/redis.conf" ]
  grafana:
    image: grafana/grafana-oss
    container_name: grafana
    restart: unless-stopped
    volumes:
      - ./internal/config/grafana/:/var/lib/grafana
    extra_hosts:
      - "postgres:192.168.1.1"
    ports:
     - '3000:3000'
  prometheus:
    image: prom/prometheus:latest
    volumes:
      - ./internal/config/prometheus/:/etc/prometheus/
    container_name: prometheus
    hostname: prometheus
    command:
      - --config.file=/etc/prometheus/prometheus.yml
    ports:
      - 9090:9090
    restart: unless-stopped
    environment:
      TZ: "Europe/Moscow"